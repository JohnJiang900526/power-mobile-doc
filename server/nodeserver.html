<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodeServer 配置信息 | 普华移动端配置文档</title>
    <meta name="description" content="Power-mobile2配置文档">
    
    
    <link rel="preload" href="/power-mobile-doc/assets/css/0.styles.a624016e.css" as="style"><link rel="preload" href="/power-mobile-doc/assets/js/app.ddba7352.js" as="script"><link rel="preload" href="/power-mobile-doc/assets/js/2.1a5ece77.js" as="script"><link rel="preload" href="/power-mobile-doc/assets/js/16.c850344d.js" as="script"><link rel="prefetch" href="/power-mobile-doc/assets/js/10.6145592f.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/11.1aa46afa.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/12.2df4289d.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/13.e989601a.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/14.e14c5fb5.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/15.70690a08.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/17.ee447d0b.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/18.8e28be43.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/19.e61bbdcb.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/20.d6c30b2c.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/21.324b503b.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/22.8bf75d9a.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/23.8888044d.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/24.3a1a1e65.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/25.caffb1be.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/26.7e3240a4.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/27.0c2ac7b0.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/3.f374de1c.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/4.b58c1e7f.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/5.d529527c.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/6.3ccde0cd.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/7.b4468298.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/8.e5c1fe98.js"><link rel="prefetch" href="/power-mobile-doc/assets/js/9.b51d1410.js">
    <link rel="stylesheet" href="/power-mobile-doc/assets/css/0.styles.a624016e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/power-mobile-doc/" class="home-link router-link-active"><!----> <span class="site-name">普华移动端配置文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/power-mobile-doc/download/" class="nav-link">文档下载</a></div><div class="nav-item"><a href="/power-mobile-doc/suggestion/email/" class="nav-link">意见反馈</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/power-mobile-doc/download/" class="nav-link">文档下载</a></div><div class="nav-item"><a href="/power-mobile-doc/suggestion/email/" class="nav-link">意见反馈</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>初识 Power-Mobile</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/start/" class="sidebar-link">介绍</a></li><li><a href="/power-mobile-doc/start/install.html" class="sidebar-link">安装 Power-Mobile APP</a></li><li><a href="/power-mobile-doc/start/version.html" class="sidebar-link">Power-Mobile 版本更新</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>APP服务端部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/server/" class="sidebar-link">PowerMobile 服务端配置文档</a></li><li><a href="/power-mobile-doc/server/config.html" class="sidebar-link">配置config.js</a></li><li><a href="/power-mobile-doc/server/configedit.html" class="sidebar-link">Power.ConfigEdit.exe APP配置信息</a></li><li><a href="/power-mobile-doc/server/nodeserver.html" class="active sidebar-link">nodeServer 配置信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#获取nodeserver文件夹" class="sidebar-link">获取nodeServer文件夹</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#安装node" class="sidebar-link">安装node</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#测试npm是否自动安装" class="sidebar-link">测试npm是否自动安装</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#安装cnpm" class="sidebar-link">安装cnpm</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#安装pm2" class="sidebar-link">安装pm2</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#配置nodeserver文件夹中的-env信息" class="sidebar-link">配置nodeServer文件夹中的.env信息</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#安装nodeserver的依赖包" class="sidebar-link">安装nodeServer的依赖包</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#测试nodeserver是否正常运行" class="sidebar-link">测试nodeServer是否正常运行</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#使用pm2管理nodeserver" class="sidebar-link">使用pm2管理nodeServer</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#nodeserver自动重启" class="sidebar-link">nodeServer自动重启</a></li><li class="sidebar-sub-header"><a href="/power-mobile-doc/server/nodeserver.html#查看执行项目的状态" class="sidebar-link">查看执行项目的状态</a></li></ul></li><li><a href="/power-mobile-doc/server/apppush.html" class="sidebar-link">APP推送消息的配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Web配置文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/web/" class="sidebar-link">PowerMobile Web配置文档</a></li><li><a href="/power-mobile-doc/web/devplat.html" class="sidebar-link">开发平台使用简要说明</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/api/" class="sidebar-link">API文档说明</a></li><li><a href="/power-mobile-doc/api/system.html" class="sidebar-link">系统方法 API</a></li><li><a href="/power-mobile-doc/api/request.html" class="sidebar-link">请求 API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>窗体的详细配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/window/" class="sidebar-link">窗体的详细配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>表单的详细配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/form/" class="sidebar-link">表单的详细配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>向导的详细配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/guide/" class="sidebar-link">向导的详细配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>企业微信配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/wechat/" class="sidebar-link">企业微信配置</a></li><li><a href="/power-mobile-doc/wechat/wechatpush.html" class="sidebar-link">微信消息推送</a></li><li><a href="/power-mobile-doc/wechat/outmenu.html" class="sidebar-link">输出PowerMobile2菜单</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>文档下载</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/download/" class="sidebar-link">下载说明</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>意见反馈</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/power-mobile-doc/suggestion/email.html" class="sidebar-link">意见反馈</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nodeserver-配置信息"><a href="#nodeserver-配置信息" class="header-anchor">#</a> nodeServer 配置信息</h1> <h2 id="获取nodeserver文件夹"><a href="#获取nodeserver文件夹" class="header-anchor">#</a> 获取nodeServer文件夹</h2> <p>获取nodeServer文件夹,
把nodeServer放在服务器上适当的位置，尽可能不要和项目文件放在一起。
比如项目的目录是D:\www\7109-PowerPMS_PMIS，那么nodeServer文件夹可
以放在D盘的根目录下，比如：D:\nodeServer</p> <h2 id="安装node"><a href="#安装node" class="header-anchor">#</a> 安装node</h2> <p>在<a href="http://nodejs.cn/" target="_blank" rel="noopener noreferrer">node官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，下载最新的node版本，安装在服务器上，
在windows系统下，一般下载的是node-v12.10.0-x64.msi文件，在服务器上点
击这个文件，按照向导进行正常操作即可。
安装完node之后，可以在cmd命令行中执行node -v的命令，如果正常安装，会打印出对应的版本号。
如下图：</p> <img src="/power-mobile-doc/img/图片4.png"> <h2 id="测试npm是否自动安装"><a href="#测试npm是否自动安装" class="header-anchor">#</a> 测试npm是否自动安装</h2> <p>安装完成node之后，一般npm会自动安装，检测npm是否自动安装的方法 可以在cmd中执行npm -v。如下图：</p> <img src="/power-mobile-doc/img/图片5.png"> <h2 id="安装cnpm"><a href="#安装cnpm" class="header-anchor">#</a> 安装cnpm</h2> <p>cnpm和npm有同样的功能，主要是安装node服务的依赖文件，npm是国外做的，
cnpm是国内做的，npm安装依赖的时候有可能会出现下载依赖报错的情况，如果
出现报错，删除nodeServer文件夹下面的node_modules的文件夹。</p> <p>安装cnpm的方法：在cmd中执行npm install cnpm -g,如下图：</p> <img src="/power-mobile-doc/img/图片6.png"> <h2 id="安装pm2"><a href="#安装pm2" class="header-anchor">#</a> 安装pm2</h2> <p>pm2主要是用来管理node服务的,类似iis一样的存在，npm install pm2 -g
或者
cnpm install pm2 -g</p> <h2 id="配置nodeserver文件夹中的-env信息"><a href="#配置nodeserver文件夹中的-env信息" class="header-anchor">#</a> 配置nodeServer文件夹中的.env信息</h2> <p>进入nodeServer文件夹，打开.env文件，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code># <span class="token punctuation">.</span>env示例文件
# 当前环境 <span class="token punctuation">:</span> dev（开发） <span class="token function">pro</span> <span class="token punctuation">(</span>生产<span class="token punctuation">)</span>
cur_env <span class="token operator">=</span> dev

# <span class="token constant">SOCKET</span>通讯服务器地址、端口
<span class="token constant">SOCKET_PORT</span> <span class="token operator">=</span> <span class="token number">3000</span>

# redis通讯服务器地址及端口
<span class="token constant">REDIS_HOST</span> <span class="token operator">=</span> xxx<span class="token punctuation">.</span>com
<span class="token constant">REDIS_PORT</span> <span class="token operator">=</span> <span class="token number">6379</span>
<span class="token constant">REDIS_PWD</span> <span class="token operator">=</span>

# 站点码
<span class="token constant">HOST_CODE</span> <span class="token operator">=</span> mis
<span class="token constant">HOST_SITE</span> <span class="token operator">=</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/xxx.com:7109/</span>

# 数据库类型 sql_server<span class="token punctuation">,</span><span class="token function">oracle</span><span class="token punctuation">(</span>不设置默认sql_server<span class="token punctuation">)</span>
<span class="token constant">DB_TYPE</span> <span class="token operator">=</span>

# 数据库连接信息，无论配置是否存在正确与否， <span class="token function">后面都会从redis重新取一次。账号，密码，服务器地址</span><span class="token punctuation">(</span>oracle有可能是<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">/</span>orcl<span class="token punctuation">)</span>，端口，数据库
<span class="token constant">DB_ID</span> <span class="token operator">=</span> test
<span class="token constant">DB_PWD</span> <span class="token operator">=</span> test@<span class="token number">2008</span>
<span class="token constant">DB_HOST</span> <span class="token operator">=</span> xxx<span class="token punctuation">.</span>com
<span class="token constant">DB_PORT</span> <span class="token operator">=</span><span class="token number">7100</span>
<span class="token constant">DB_DATABASE</span> <span class="token operator">=</span> PowerPMDB_PMIS

# 极光推送配置
<span class="token constant">T_KEY</span> <span class="token operator">=</span> f1b07a32465bd1741978f8e6
<span class="token constant">T_SECRET</span> <span class="token operator">=</span> da057374ad2ca2af815599ee

# MongoDB 这里的配置可以忽略
<span class="token constant">MONGO_DB</span> <span class="token operator">=</span> app_msg
# <span class="token constant">MONGO_URL</span> <span class="token operator">=</span> mongodb<span class="token operator">+</span>srv<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>admin<span class="token punctuation">:</span>admin_123@cluster0<span class="token operator">-</span><span class="token number">35</span>wrv<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>net<span class="token operator">/</span>app_msg<span class="token operator">?</span>retryWrites<span class="token operator">=</span><span class="token boolean">true</span>
# 本机不加密数据库
<span class="token constant">MONGO_URL</span> <span class="token operator">=</span> mongodb<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">27017</span><span class="token operator">/</span>app_msg<span class="token operator">?</span>retryWrites<span class="token operator">=</span><span class="token boolean">true</span>
</code></pre></div><ol><li><p>SOCKET通讯服务器地址、端口
配置 SOCKET通讯服务器地址、端口，比如是3000，保证此端口号没有被占用，否则设置失败。</p></li> <li><p>redis通讯服务器地址及端口</p></li></ol> <p>1).配置REDIS_HOST，配置项目所需要的redis的host,比如：xxx.com</p> <p>2).配置REDIS_PORT，配置redis的端口号，比如7109</p> <p>3).配置REDIS_PWD的密码，如果为空则不用配置</p> <ol start="3"><li>配置站点码
1).配置站点码HOST_CODE，比如mis,必须保证站点码的唯一性</li></ol> <p>2).配置站点地址HOST_SITE，比如：http://xxx:7109/，
HOST_SITE代表的是项目的站点地址，在1).中的站点码就是
HOST_SITE的站点码，站点码设置的地方在下图所示位置：</p> <img src="/power-mobile-doc/img/图片7.png"> <ol start="4"><li>数据库连接信息，无论配置是否存在正确与否， 后面都会从redis重新取一次。账号，密码，服务器地址，端口，数据库</li></ol> <p>1).数据库账号DB_ID，比如john</p> <p>2).数据库密码DB_PWD,比如john123456</p> <p>3).服务器地址DB_HOST,比如dev.p3china.com</p> <p>4).数据库端口DB_PORT，比如：7112</p> <p>5).数据库名称DB_DATABASE</p> <h2 id="安装nodeserver的依赖包"><a href="#安装nodeserver的依赖包" class="header-anchor">#</a> 安装nodeServer的依赖包</h2> <p>比如nodeServer文件夹的目录为D:/nodeServer，cmd打开对应的路径，执行cnpm install,
依赖安装需要一定的时间，耐心等待所有的依赖安装完成。如下图：</p> <img src="/power-mobile-doc/img/图片8.png"> <h2 id="测试nodeserver是否正常运行"><a href="#测试nodeserver是否正常运行" class="header-anchor">#</a> 测试nodeServer是否正常运行</h2> <p>点击nodeServer文件夹下面的启动服务.bat文件，临时启动项目，如果bat文件启动无误，则nodeServer可以正常运行。</p> <h2 id="使用pm2管理nodeserver"><a href="#使用pm2管理nodeserver" class="header-anchor">#</a> 使用pm2管理nodeServer</h2> <p>使用cmd进入nodeServer的目录，执行pm2 start index.js,如下图：</p> <img src="/power-mobile-doc/img/图片9.png"> <h2 id="nodeserver自动重启"><a href="#nodeserver自动重启" class="header-anchor">#</a> nodeServer自动重启</h2> <p>为了保证nodeServer在服务器重启之后能自动重启，可以执行pm2 save 命令，如下图</p> <img src="/power-mobile-doc/img/图片10.png"> <h2 id="查看执行项目的状态"><a href="#查看执行项目的状态" class="header-anchor">#</a> 查看执行项目的状态</h2> <p>保证nodeServer能正常运行，可以通过pm2 list查看执行项目的状态，
如果nodeServer出现意外挂掉了，可以手动重启，
具体的命令行参考<a href="https://www.jianshu.com/p/9cab8f7020c1" target="_blank" rel="noopener noreferrer">pm2的命令行列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/power-mobile-doc/server/configedit.html" class="prev">Power.ConfigEdit.exe APP配置信息</a></span> <span class="next"><a href="/power-mobile-doc/server/apppush.html">APP推送消息的配置</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/power-mobile-doc/assets/js/app.ddba7352.js" defer></script><script src="/power-mobile-doc/assets/js/2.1a5ece77.js" defer></script><script src="/power-mobile-doc/assets/js/16.c850344d.js" defer></script>
  </body>
</html>
