(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{390:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"nodeserver-https配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodeserver-https配置"}},[t._v("#")]),t._v(" nodeServer https配置")]),t._v(" "),a("h2",{attrs:{id:"node支持https-通过nginx代理实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node支持https-通过nginx代理实现"}},[t._v("#")]),t._v(" Node支持https,通过nginx代理实现")]),t._v(" "),a("p",[t._v("有的项目上需要把node启的服务部署到https，这就需要node支持https。\nnode里聊天功能使用到socket.io，对https的支持不那么友好。所以我\n们想通过nginx代理的方式，把http服务代理到https上，其实就是一个\n转换的过程，从而实现node启的服务支持https。")]),t._v(" "),a("h2",{attrs:{id:"环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),a("ol",[a("li",[t._v("nginx包（项目上上用的版本是1.14.2，其它版本应该也可以）")]),t._v(" "),a("li",[t._v("https服务器的安全证书，主要是用到秘钥和安全证书")]),t._v(" "),a("li",[t._v("新的端口号并且已映射，外网可访问")]),t._v(" "),a("li",[t._v("nginx包可以放在服务器的任何地方，别误删了就可以。")])]),t._v(" "),a("h2",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),a("p",[t._v("其实在nodeServer文件夹中，有了1.14.2版本的nginx包\n"),a("img",{attrs:{src:t.$withBase("/img/20200423134441.png")}})]),t._v(" "),a("h2",{attrs:{id:"如何配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何配置"}},[t._v("#")]),t._v(" 如何配置")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("把证书里的秘钥和安全证书放到nginx包里的conf文件夹下\n"),a("img",{attrs:{src:t.$withBase("/img/20191209102524263.png")}})])]),t._v(" "),a("li",[a("p",[t._v("修改conf文件夹下的nginx.conf文件，增加如下代码`#HTTPS server")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("666")]),t._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("p3china"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  ssl_certificate "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("_dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("p3china"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com_bundle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("crt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ssl_certificate_key "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("_dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("p3china"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  charset "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UTF")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  ssl_session_cache shared"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ssl_session_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_http_version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_pass http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      proxy_set_header Host host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" server_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header Upgrade $http_upgrade"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header Connection “upgrade”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("代码说明如下图所示:\n"),a("img",{attrs:{src:t.$withBase("/img/20191209104139924.png")}})]),t._v(" "),a("h2",{attrs:{id:"启动nginx服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动nginx服务"}},[t._v("#")]),t._v(" 启动nginx服务")]),t._v(" "),a("p",[t._v("服务器创个文件夹放nginx包，")]),t._v(" "),a("p",[t._v("cmd 启动命令行，cd到nginx目录下")]),t._v(" "),a("p",[t._v("执行strat nginx，")]),t._v(" "),a("p",[t._v("再执行taskkill /f /t /im nginx.exe(终止进程),如下图所示\n"),a("img",{attrs:{src:t.$withBase("/img/20191209105501202.png")}})]),t._v(" "),a("p",[t._v("再次执行strat nginx就行。")]),t._v(" "),a("h2",{attrs:{id:"如何在前端代码里引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何在前端代码里引用"}},[t._v("#")]),t._v(" 如何在前端代码里引用")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node服务器地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_SITE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://dev.p3china.com:666/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);